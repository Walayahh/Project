<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>StudyBuddy</title>

  <!-- Original Google API loader -->
  <script src="https://apis.google.com/js/api.js" defer></script>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>

  <!-- Three.js & Vanta.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vanta/0.5.24/vanta.dots.min.js" defer></script>

  <!-- Confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js" defer></script>

  <link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>
<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  defer
></script>

  <style>
    /* Enhanced CSS Styling for StudyBuddy */
/* Add these styles to the existing CSS */

/* Improved map styling */
#map {
  width: 100%;
  height: 500px;
  border-radius: var(--rad-m);
  margin-bottom: 1.5rem;
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: var(--shadow-s);
  position: relative;
  z-index: 1;
}

/* Custom Leaflet styling */
.leaflet-container {
  background: #1e1e1e;
  font-family: 'Inter', sans-serif;
}

.leaflet-popup-content-wrapper {
  background: var(--bg-2);
  color: var(--txt-1);
  border-radius: var(--rad-m);
  padding: 0;
  box-shadow: var(--shadow-s);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.leaflet-popup-tip {
  background: var(--bg-2);
  box-shadow: var(--shadow-s);
}

.leaflet-popup-content {
  margin: 8px;
  width: auto !important;
}

.leaflet-control {
  margin: 10px !important;
}

.leaflet-bar a {
  background: var(--bg-2);
  color: var(--txt-1);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.leaflet-bar a:hover {
  background: var(--bg-3);
  color: var(--ac-1);
}

.leaflet-control-attribution {
  background: rgba(30, 30, 30, 0.7) !important;
  color: var(--txt-2) !important;
  backdrop-filter: blur(5px);
  padding: 3px 8px;
  border-radius: 4px;
}

.leaflet-control-attribution a {
  color: var(--ac-1) !important;
}

/* Enhanced study planner styling */
#plannerAdvice h3 {
  margin-top: 20px;
  margin-bottom: 10px;
  color: var(--ac-1);
  border-bottom: 1px solid var(--ac-1);
  padding-bottom: 5px;
}

#plannerAdvice div {
  line-height: 1.5;
}

#plannerAdvice strong {
  color: var(--ac-1);
}

/* Download button for study plan */
#downloadPlan {
  margin: 15px auto;
  display: block;
}

/* Enhanced forms */
#reviewForm, #plannerForm {
  background: var(--bg-3);
  padding: 15px;
  border-radius: var(--rad-m);
  margin-bottom: 20px;
  border: 1px solid rgba(255, 255, 255, 0.05);
}

#reviewForm input, #reviewForm select, #reviewForm textarea,
#plannerForm input, #plannerForm select, #plannerForm textarea {
  background: var(--bg-2);
  transition: all 0.2s ease;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

#reviewForm input:focus, #reviewForm select:focus, #reviewForm textarea:focus,
#plannerForm input:focus, #plannerForm select:focus, #plannerForm textarea:focus {
  border-color: var(--ac-1);
  box-shadow: 0 0 0 2px rgba(140, 103, 255, 0.2);
}

/* Better form layout for reviews */
#reviewForm {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}

#reviewForm div:first-child {
  grid-column: span 2;
}

#reviewForm textarea {
  grid-column: span 2;
}

#reviewForm button {
  grid-column: span 2;
  margin-top: 0.5rem;
}

/* Enhanced cafe review cards */
.cafe-review-card {
  background: var(--bg-2);
  border-radius: var(--rad-m);
  padding: 1.25rem;
  box-shadow: var(--shadow-s);
  border: 1px solid rgba(255, 255, 255, 0.05);
  transition: all 0.3s ease;
  position: relative;
}

.cafe-review-card:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-l);
}

.review-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.5rem;
}

.review-body {
  margin-bottom: 0.5rem;
  line-height: 1.5;
}

.review-rating {
  color: var(--ac-warn);
  font-size: 1.1rem;
}

.review-footer {
  font-size: 0.8rem;
  color: var(--txt-2);
  display: flex;
  justify-content: space-between;
  margin-top: 0.8rem;
  padding-top: 0.5rem;
  border-top: 1px solid rgba(255, 255, 255, 0.05);
}

/* Better styling for the review name input with datalist */
#reviewName {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='rgba(255, 255, 255, 0.5)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z'%3E%3C/path%3E%3Ccircle cx='12' cy='10' r='3'%3E%3C/circle%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: 10px center;
  padding-left: 2.5rem;
}

/* Add smooth animations */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.fade-in {
  animation: fadeIn 0.4s ease forwards;
}

/* Add some visual flare to the study planner */
#planList .card {
  position: relative;
  overflow: hidden;
}

#planList .card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 4px;
  height: 100%;
  background: linear-gradient(to bottom, var(--ac-1), var(--ac-3));
  border-radius: var(--rad-s) 0 0 var(--rad-s);
}

#planList .card h4 {
  margin-left: 8px;
}

/* Enhanced planner button */
#planStudy {
  background: linear-gradient(135deg, var(--ac-1), var(--ac-2));
  padding: 0.8rem 1.6rem;
  font-weight: 600;
  letter-spacing: 0.5px;
  transition: all 0.3s ease;
  margin-bottom: 1rem;
}

#planStudy:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 15px rgba(140, 103, 255, 0.3);
}

/* Make loading indicators consistent */
.loading-spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 2px solid rgba(140, 103, 255, 0.3);
  border-radius: 50%;
  border-top-color: var(--ac-1);
  animation: spin 1s linear infinite;
  margin-right: 8px;
  vertical-align: middle;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Add responsive improvements */
@media (max-width: 768px) {
  header {
    padding: 0.8rem 1rem;
  }
  
  .logo {
    font-size: 1.2rem;
  }
  
  main {
    padding: 1rem;
  }
  
  nav button {
    padding: 0.4rem 0.7rem;
    font-size: 0.9rem;
  }
  
  #map {
    height: 350px;
  }
  
  #reviewForm {
    display: block;
  }
  
  #timerDisplay {
    font-size: 2rem;
  }
  
  #tasksBoard {
    flex-direction: column;
  }
  
  .column {
    margin-bottom: 1rem;
  }
  
  #quotes {
    grid-template-columns: 1fr;
  }
}

/* Improve dark mode legibility */
::placeholder {
  color: rgba(176, 176, 176, 0.6);
}

select option {
  background-color: var(--bg-3);
}

/* Touch-specific enhancements */
.touch-device .task {
  position: relative;
}

.touch-device .task-buttons {
  position: absolute;
  right: 10px;
  display: flex;
  gap: 5px;
}

/* Focus styles for accessibility */
button:focus, input:focus, select:focus, textarea:focus {
  outline: 2px solid var(--ac-1);
  outline-offset: 2px;
}

/* Dark scrollbars for better aesthetics */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--bg-1);
}

::-webkit-scrollbar-thumb {
  background: var(--bg-3);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--ac-1);
}

    :root {
      --bg-1:#121212; --bg-2:#1e1e1e; --bg-3:#2d2d2d;
      --txt-1:#fafafa; --txt-2:#b0b0b0;
      --ac-1:#8c67ff; --ac-2:#4f46e5; --ac-3:#ff6f91; --ac-warn:#f2c94c;
      --rad-s:6px; --rad-m:12px; --rad-l:20px;
      --shadow-s:0 4px 20px rgba(0,0,0,.15);
      --shadow-l:0 8px 30px rgba(0,0,0,.35);
    }
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0;font-family:'Inter',sans-serif;}
    body{background:var(--bg-1);color:var(--txt-1);min-height:100vh;display:flex;flex-direction:column;overflow-x:hidden;}
    a{color:var(--ac-1);text-decoration:none;transition:all .2s ease;}a:hover{text-decoration:underline;}
    #background{position:fixed;inset:0;z-index:-1;}
    header{position:sticky;top:0;display:flex;align-items:center;justify-content:space-between;padding:1rem 2rem;background:rgba(30,30,30,.85);backdrop-filter:blur(10px);box-shadow:var(--shadow-s);z-index:10;}
    .logo-container{display:flex;align-items:center;gap:.6rem;}
    .logo-icon{width:34px;height:34px;border-radius:8px;background:linear-gradient(135deg,var(--ac-1),var(--ac-2));display:grid;place-content:center;color:#fff;font-weight:700;}
    .logo{font-size:1.5rem;font-weight:700;background:linear-gradient(90deg,var(--ac-1),var(--ac-3));-webkit-background-clip:text;color:transparent;}
    nav{display:flex;gap:.3rem;flex-wrap:wrap;}
    nav button{background:none;border:none;color:var(--txt-2);padding:.55rem .95rem;border-radius:var(--rad-s);cursor:pointer;transition:all .2s ease;position:relative;}
    nav button:hover, nav button.active{background:rgba(140,103,255,.12);color:var(--txt-1);}
    nav button.active::after{content:'';position:absolute;left:50%;bottom:0;transform:translateX(-50%);width:22px;height:3px;background:var(--ac-1);border-radius:5px;}
    main{flex:1;max-width:1400px;margin:0 auto;padding:2rem;}
    section{display:none;animation:fade .35s ease-in-out;}section.active{display:block;}
    @keyframes fade{from{opacity:0;transform:translateY(12px);}to{opacity:1;transform:translateY(0);}}
    h2.section-title{font-size:1.75rem;margin-bottom:1.4rem;}
    .card{background:var(--bg-2);padding:1.25rem;border-radius:var(--rad-m);box-shadow:var(--shadow-s);border:1px solid rgba(255,255,255,.05);transition:all .3s ease;position:relative;}
    .card:hover{transform:translateY(-4px);box-shadow:var(--shadow-l);}
    .btn{display:inline-flex;align-items:center;gap:.45rem;border:none;cursor:pointer;padding:.7rem 1.4rem;font-weight:500;border-radius:var(--rad-s);box-shadow:0 2px 6px rgba(0,0,0,.2);transition:all .2s ease;}
    .btn:hover{transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.3);}
    .btn-primary{background:var(--ac-1);color:#fff;} .btn-secondary{background:rgba(255,255,255,.1);color:var(--txt-1);} .btn-small{padding:.3rem .6rem;font-size:.8rem;}
    input,textarea,select{background:var(--bg-3);border:1px solid rgba(255,255,255,.1);color:var(--txt-1);padding:.75rem;border-radius:var(--rad-s);width:100%;margin-bottom:1rem;transition:border-color .2s ease;}
    input:focus,textarea:focus,select:focus{outline:none;border-color:var(--ac-1);}
    /* Quotes */
    #quotes{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:1rem;}
    #quotes .card{font-style:italic;text-align:center;color:var(--txt-2);}
    /* Pomodoro */
    #timerDisplay{font-size:2.5rem;text-align:center;margin:1rem 0;}
    #timerControls{display:flex;justify-content:center;gap:1rem;}
    /* Tasks */
    #tasksBoard{display:flex;gap:1rem;margin-top:1rem;}
    .column{background:var(--bg-2);flex:1;min-width:240px;padding:1rem;border-radius:var(--rad-m);position:relative;}
    .column h3{margin-bottom:.8rem;color:var(--txt-2);}
    .task{background:var(--bg-3);padding:.6rem 1rem;border-radius:var(--rad-s);margin-bottom:.6rem;display:flex;align-items:center;justify-content:space-between;}
    .task-buttons button{margin-left:.5rem;}
    /* Map */
    #map{width:100%;height:350px;border-radius:var(--rad-m);margin-bottom:1rem;}
    /* Reviews */
    .delete-review{position:absolute;top:4px;right:8px;cursor:pointer;color:var(--ac-warn);font-weight:bold;}
    .delete-review:hover{color:var(--ac-3);}
    /* Games */
    #gameSelect{margin-bottom:1rem;}
    /* Make iframe much bigger */
    #gameFrame{width:100%;height:80vh;border:none;border-radius:var(--rad-m);margin-top:1rem;box-shadow:var(--shadow-s);}
    /* Planner */
    #planList .card{margin-bottom:1rem;padding-right:2.5rem;}
    #plannerAdvice{margin-top:1rem;background:var(--bg-3);padding:1rem;border-radius:var(--rad-s);max-height:300px;overflow-y:auto;white-space:pre-wrap;line-height:1.5;}
    .delete-plan{position:absolute;top:10px;right:10px;cursor:pointer;color:var(--ac-warn);font-weight:bold;font-size:1.2rem;}
    .delete-plan:hover{color:var(--ac-3);}
    /* Chat */
    #chatToggle{position:fixed;bottom:1rem;right:1rem;width:56px;height:56px;border-radius:50%;background:var(--ac-1);color:#fff;font-size:1.5rem;border:none;cursor:pointer;box-shadow:var(--shadow-l);z-index:20;transition:transform 0.3s ease,box-shadow 0.3s ease;}
    #chatToggle:hover{transform:scale(1.1);box-shadow:0 10px 40px rgba(140,103,255,.4);}
    #chatWidget{position:fixed;bottom:1.5rem;right:1.5rem;width:340px;height:400px;background:var(--bg-2);border-radius:var(--rad-l);box-shadow:var(--shadow-l);display:flex;flex-direction:column;overflow:hidden;z-index:20;opacity:0;transform:translateY(20px) scale(0.8);pointer-events:none;transition:opacity .3s ease,transform .3s ease;}
    #chatWidget.open{opacity:1;transform:translateY(0) scale(1);pointer-events:all;}
    #chatHeader{background:linear-gradient(135deg,var(--ac-1),var(--ac-2));color:#fff;padding:1rem;display:flex;justify-content:space-between;align-items:center;border-top-left-radius:var(--rad-l);border-top-right-radius:var(--rad-l);}
    #chatClose{background:none;border:none;color:#fff;font-size:1.2rem;cursor:pointer;transition:transform .2s ease;}
    #chatClose:hover{transform:rotate(90deg);}
    #chatBody{flex:1;overflow-y:auto;padding:1rem;display:flex;flex-direction:column;gap:.7rem;scroll-behavior:smooth;background:rgba(18,18,18,.3);}
    .row{display:flex;}
    .row.me{justify-content:flex-end;}
    .row p{padding:.75rem 1rem;border-radius:18px;max-width:80%;font-size:.88rem;line-height:1.5;}
    .me p{background:linear-gradient(135deg,var(--ac-1),var(--ac-2));color:#fff;border-bottom-right-radius:6px;}
    .bot p{background:var(--bg-3);color:var(--txt-1);border-bottom-left-radius:6px;}
    #chatInput{display:flex;border-top:1px solid rgba(255,255,255,.06);}
    #chatInput input{flex:1;border:none;background:var(--bg-3);color:var(--txt-1);padding:.75rem 1rem;border-radius:var(--rad-s);margin:.5rem;outline:none;}
    #chatInput button{width:42px;height:42px;margin:.5rem;border-radius:50%;background:var(--ac-1);border:none;color:#fff;transition:all .2s ease;cursor:pointer;}
    #chatInput button:hover{transform:scale(1.1);background:var(--ac-2);}
    /* Celebration */
    #celebrationPopup{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(135deg,var(--ac-1),var(--ac-2));color:#fff;padding:2rem;border-radius:var(--rad-l);text-align:center;z-index:100;box-shadow:var(--shadow-l);animation:popIn .5s cubic-bezier(.175,.885,.32,1.275) forwards;}
    #celebrationPopup .emoji{font-size:4rem;margin-bottom:1rem;display:block;}
    #celebrationPopup h2{font-size:2rem;margin-bottom:1rem;}
    #celebrationPopup button{margin-top:1rem;background:rgba(255,255,255,.2);border:none;color:#fff;padding:.5rem 1.5rem;border-radius:var(--rad-s);cursor:pointer;transition:all .2s ease;}
    #celebrationPopup button:hover{background:rgba(255,255,255,.3);}
    @keyframes popIn{0%{transform:translate(-50%,-50%) scale(.8);opacity:0;}100%{transform:translate(-50%,-50%) scale(1);opacity:1;}}
    :root {
      --bg-1: #121212;
      --bg-2: #1e1e1e;
      --bg-3: #2d2d2d;
      --txt-1: #fafafa;
      --txt-2: #b0b0b0;
      --ac-1: #8c67ff;
      --ac-2: #4f46e5;
      --ac-3: #ff6f91;
      --ac-warn: #f2c94c;
      --rad-s: 6px;
      --rad-m: 12px;
      --rad-l: 20px;
      --shadow-s: 0 4px 20px rgba(0, 0, 0, .15);
      --shadow-l: 0 8px 30px rgba(0, 0, 0, .35);
    }
  
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
    }
  
    body {
      background: var(--bg-1);
      color: var(--txt-1);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
    }
  
    a {
      color: var(--ac-1);
      text-decoration: none;
      transition: all .2s ease;
    }
    a:hover {
      text-decoration: underline;
    }
  
    #background {
      position: fixed;
      inset: 0;
      z-index: -1;
    }
  
    header {
      position: sticky;
      top: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 2rem;
      background: rgba(30, 30, 30, .85);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow-s);
      z-index: 10;
    }
  
    .logo-container {
      display: flex;
      align-items: center;
      gap: .6rem;
    }
  
    .logo-icon {
      width: 34px;
      height: 34px;
      border-radius: 8px;
      background: linear-gradient(135deg, var(--ac-1), var(--ac-2));
      display: grid;
      place-content: center;
      color: #fff;
      font-weight: 700;
    }
  
    .logo {
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(90deg, var(--ac-1), var(--ac-3));
      -webkit-background-clip: text;
      color: transparent;
    }
  
    nav {
      display: flex;
      gap: .3rem;
      flex-wrap: wrap;
    }
  
    nav button {
      background: none;
      border: none;
      color: var(--txt-2);
      padding: .55rem .95rem;
      border-radius: var(--rad-s);
      cursor: pointer;
      transition: all .2s ease;
      position: relative;
    }
    nav button:hover,
    nav button.active {
      background: rgba(140, 103, 255, .12);
      color: var(--txt-1);
    }
    #map {
      width: 100%;
      height: 500px;
      border-radius: var(--rad-m);
      margin-bottom: 1.5rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: var(--shadow-s);
    }
  
    /* Improved cafe review styling */
    #reviewForm {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }
  
    #reviewForm textarea {
      grid-column: span 2;
    }
  
    #reviewForm button {
      margin-top: 0.5rem;
    }
  
    /* Search input styling */
    .search-control input {
      background: var(--bg-3);
      color: var(--txt-1);
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 0.6rem;
      border-radius: var(--rad-s);
      width: 220px;
      box-shadow: var(--shadow-s);
      margin-bottom: 0 !important;
    }
  
    .search-control input:focus {
      outline: none;
      border-color: var(--ac-1);
    }
  
    /* Loading indicator */
    .loading-indicator span {
      background: rgba(30, 30, 30, 0.8);
      color: var(--txt-1);
      padding: 8px 12px;
      border-radius: var(--rad-s);
      font-size: 0.9rem;
      display: inline-block;
      box-shadow: var(--shadow-s);
    }
  
    /* Marker cluster styling */
    .marker-cluster {
      background-color: rgba(140, 103, 255, 0.6);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    }
  
    /* Leaflet popup styling */
    .leaflet-popup-content-wrapper {
      background: var(--bg-2);
      color: var(--txt-1);
      border-radius: var(--rad-m);
      padding: 0.5rem;
      box-shadow: var(--shadow-s);
    }
  
    .leaflet-popup-tip {
      background: var(--bg-2);
    }
  
    .leaflet-popup-content {
      margin: 0.5rem;
    }
  
    /* Enhanced review form */
    #cafeReviews {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1rem;
    }
  
    .cafe-review-card {
      background: var(--bg-2);
      border-radius: var(--rad-m);
      padding: 1rem;
      box-shadow: var(--shadow-s);
      border: 1px solid rgba(255, 255, 255, 0.05);
      transition: all 0.3s ease;
    }
  
    .review-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
  
    .review-body {
      margin-bottom: 0.5rem;
    }
  
    .review-footer {
      font-size: 0.8rem;
      color: var(--txt-2);
    }
    
    /* DataList enhancement */
    #reviewName {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='rgba(255, 255, 255, 0.5)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z'%3E%3C/path%3E%3Ccircle cx='12' cy='10' r='3'%3E%3C/circle%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: 10px center;
      padding-left: 2.5rem;
    }
    nav button.active::after {
      content: '';
      position: absolute;
      left: 50%;
      bottom: 0;
      transform: translateX(-50%);
      width: 22px;
      height: 3px;
      background: var(--ac-1);
      border-radius: 5px;
    }
  
    main {
      flex: 1;
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
    }
  
    section {
      display: none;
      animation: fade .35s ease-in-out;
    }
    section.active {
      display: block;
    }
  
    @keyframes fade {
      from {
        opacity: 0;
        transform: translateY(12px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  
    h2.section-title {
      font-size: 1.75rem;
      margin-bottom: 1.4rem;
    }
  
    .card {
      background: var(--bg-2);
      padding: 1.25rem;
      border-radius: var(--rad-m);
      box-shadow: var(--shadow-s);
      border: 1px solid rgba(255, 255, 255, .05);
      transition: all .3s ease;
      position: relative;
    }
    .card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-l);
    }
  
    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: .45rem;
      border: none;
      cursor: pointer;
      padding: .7rem 1.4rem;
      font-weight: 500;
      border-radius: var(--rad-s);
      box-shadow: 0 2px 6px rgba(0, 0, 0, .2);
      transition: all .2s ease;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, .3);
    }
  
    .btn-primary {
      background: var(--ac-1);
      color: #fff;
    }
    .btn-secondary {
      background: rgba(255, 255, 255, .1);
      color: var(--txt-1);
    }
    .btn-small {
      padding: .3rem .6rem;
      font-size: .8rem;
    }
  
    /* Inputs */
    input,
    textarea,
    select {
      background: var(--bg-3);
      border: 1px solid rgba(255, 255, 255, .1);
      color: var(--txt-1);
      padding: .75rem;
      border-radius: var(--rad-s);
      width: 100%;
      margin-bottom: 1rem;
      transition: border-color .2s ease;
    }
    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: var(--ac-1);
    }
  
    /* Quotes */
    #quotes {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1rem;
    }
    #quotes .card {
      font-style: italic;
      text-align: center;
      color: var(--txt-2);
    }
  
    /* Pomodoro Timer */
    #timerDisplay {
      font-size: 2.5rem;
      text-align: center;
      margin: 1rem 0;
    }
    #timerControls {
      display: flex;
      justify-content: center;
      gap: 1rem;
    }
  
    /* Tasks Board */
    #tasksBoard {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }
    .column {
      background: var(--bg-2);
      flex: 1;
      min-width: 240px;
      padding: 1rem;
      border-radius: var(--rad-m);
      position: relative;
    }
    .column h3 {
      margin-bottom: .8rem;
      color: var(--txt-2);
    }
    .task {
      background: var(--bg-3);
      padding: .6rem 1rem;
      border-radius: var(--rad-s);
      margin-bottom: .6rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .task-buttons button {
      margin-left: .5rem;
    }
  
    /* Map (Leaflet) */
    #map {
      width: 100%;
      height: 350px;
      border-radius: var(--rad-m);
      margin-bottom: 1rem;
    }
  
    /* Reviews */
    .delete-review {
      position: absolute;
      top: 4px;
      right: 8px;
      cursor: pointer;
      color: var(--ac-warn);
      font-weight: bold;
    }
    .delete-review:hover {
      color: var(--ac-3);
    }
  
    /* Games */
    #gameSelect {
      margin-bottom: 1rem;
    }
    #gameFrame {
      width: 100%;
      height: 80vh;
      border: none;
      border-radius: var(--rad-m);
      margin-top: 1rem;
      box-shadow: var(--shadow-s);
    }
  </style>
</head>
<body>
  <div id="background"></div>
  <header>
    <div class="logo-container"><div class="logo-icon">S</div><span class="logo">StudyBuddy</span></div>
    <nav>
      <button class="active" data-target="dashboard">Dashboard</button>
      <button data-target="cafes">Caf√©s</button>
      <button data-target="games">Play</button>
      <button data-target="sessions">Sessions</button>
      <button data-target="planner">Planner</button>
    </nav>
  </header>

  <main>
    <!-- Dashboard -->
    <section id="dashboard" class="active">
      <h2 class="section-title">Dashboard</h2>
      <div id="quotes"></div>
      <button id="refreshQuotes" class="btn btn-small btn-primary">Refresh Quotes</button>

      <div class="card">
        <h3>Pomodoro Timer</h3>
        <div id="timerDisplay">25:00</div>
        <div id="timerControls">
          <button id="startTimer" class="btn btn-primary">Start</button>
          <button id="pauseTimer" class="btn btn-secondary">Pause</button>
          <button id="resetTimer" class="btn btn-secondary">Reset</button>
        </div>
      </div>

      <div class="card">
        <h3>Tasks</h3>
        <form id="newTaskForm">
          <input id="newTaskInput" type="text" placeholder="New task‚Ä¶ (Enter or click Add)" required/>
          <button type="submit" class="btn btn-primary btn-small">Add</button>
        </form>
        <div id="tasksBoard">
          <div class="column" data-status="todo"><h3>To Do</h3></div>
          <div class="column" data-status="inprogress"><h3>In Progress</h3></div>
          <div class="column" data-status="completed"><h3>Completed</h3></div>
        </div>
      </div>
    </section>

    <!-- Caf√©s -->
<!-- Caf√©s -->
<section id="cafes">
  <h2 class="section-title">Study Caf√©s</h2>
  <div id="map"></div>
  
  <div class="card">
    <h3>Add Caf√© Review</h3>
    <form id="reviewForm">
      <div style="position: relative; grid-column: span 2;">
        <input id="reviewName" list="cafeList" type="text" placeholder="Choose a cafe or type a name..." required/>
        <datalist id="cafeList"></datalist>
      </div>
      <select id="reviewRating" required>
        <option value="">Select Rating...</option>
        <option value="1">‚òÖ (Poor)</option>
        <option value="2">‚òÖ‚òÖ (Fair)</option>
        <option value="3">‚òÖ‚òÖ‚òÖ (Good)</option>
        <option value="4">‚òÖ‚òÖ‚òÖ‚òÖ (Very Good)</option>
        <option value="5">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ (Excellent)</option>
      </select>
      <select id="reviewCategory" required>
        <option value="">Best For...</option>
        <option value="studying">Studying</option>
        <option value="reading">Reading</option>
        <option value="meetings">Meetings</option>
        <option value="relaxing">Relaxing</option>
        <option value="food">Food & Drinks</option>
      </select>
      <textarea id="reviewText" rows="3" placeholder="Share your experience... Were the tables good for studying? How was the WiFi? Was it quiet?" required></textarea>
      <button class="btn btn-primary" type="submit">Save Review</button>
    </form>
  </div>
  
  <div id="cafeReviews"></div>
</section>
    <!-- Games -->
    <section id="games">
      <h2 class="section-title">Take a Break</h2>
      <select id="gameSelect"></select>
      <iframe id="gameFrame"></iframe>
    </section>

    <!-- Sessions -->
    <section id="sessions">
      <h2 class="section-title">Study Sessions</h2>
      <div class="card">
        <h3>New Session</h3>
        <form id="sessionForm" class="grid two-col">
          <div><label>Topic</label><input id="sessionTopic" type="text" required/></div>
          <div><label>Date</label><input id="sessionDate" type="date" required/></div>
          <div><label>Duration</label><input id="sessionDuration" type="number" required/></div>
          <div style="grid-column:1/-1;"><button class="btn btn-primary" type="submit">Add</button></div>
        </form>
      </div>
      <ul id="sessionList"></ul>
    </section>

    <!-- Planner -->
    <section id="planner">
      <h2 class="section-title">Study Planner</h2>
      <div class="card">
        <h3>Add Planner Task</h3>
        <form id="plannerForm">
          <input id="planTitle" type="text" placeholder="Title‚Ä¶" required style="width:48%;display:inline-block;margin-right:2%;"/>
          <select id="planCat" style="width:48%;display:inline-block;" required>
            <option value="">Category‚Ä¶</option><option>Homework</option><option>Reading</option><option>Project</option><option>Review</option>
          </select>
          <textarea id="planDesc" rows="2" placeholder="Description‚Ä¶"></textarea>
          <input id="planDate" type="date" required/>
          <button class="btn btn-primary" type="submit">Add Task</button>
        </form>
      </div>
      <div id="planList"></div>
      <button id="planStudy" class="btn btn-primary">Plan My Study</button>
      <div id="plannerAdvice"></div>
    </section>
  </main>

  <!-- Chat -->
  <button id="chatToggle">üí¨</button>
  <div id="chatWidget">
    <div id="chatHeader">
      StudyBuddy AI
      <button id="chatClose">‚úï</button>
    </div>
    <div id="chatBody"></div>
    <form id="chatInput">
      <input type="text" placeholder="Ask a question‚Ä¶" autocomplete="off" required/>
      <button type="submit">‚û§</button>
    </form>
  </div>

  <!-- Celebration -->
  <div id="celebrationPopup">
    <span class="emoji">üéâ</span>
    <h2>Great Job!</h2>
    <p>You've completed a task!</p>
    <button id="closeCelebration">Continue</button>
  </div>

  <script>
// studybuddy.js ‚Äì single‚Äëbundle runtime (2025‚Äë05‚Äë01)
// ------------------------------------------------------------
// Everything StudyBuddy needs lives here.  Drop ONE <script>
// tag that points to this file at the very end of <body>.
// ------------------------------------------------------------

// studybuddy.js ‚Äì 2025-05-01
// ------------------------------------------------------------
// One drop-in <script> gives you toasts, map, caf√© reviews‚Ä¶
// ------------------------------------------------------------
/*  StudyBuddy ‚Äì unified bundle
    ------------------------------------------------------------
    saves to localStorage under keys:
      sb-quotes  (none ‚Äì static list)
      sb-tasks   [{ status, text }]
      sb-reviews [{ id, name, rating, category, text, date }]
      sb-sessions[{ topic,date,duration }]
      sb-plans   [{ title,category,desc,date }]
*/
(() => {
  "use strict";
  
  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  tiny DOM helpers  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  const  $ = (sel, ctx=document) => ctx.querySelector(sel),
        $$ = (sel, ctx=document) => [...ctx.querySelectorAll(sel)];
  
  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  toast system  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  const toastRoot = (() => {
    const el = document.createElement("div");
    el.id = "toast-root";
    el.style.cssText = `
      position:fixed;bottom:20px;right:20px;z-index:9999;
      display:flex;flex-direction:column;gap:10px;max-width:300px;`;
    document.addEventListener("DOMContentLoaded", () => document.body.append(el));
    return el;
  })();
  function toast(msg, type="info", ms=3000) {
    const t = document.createElement("div");
    t.className = `toast ${type}`;
    t.innerHTML = `${msg}<span style="position:absolute;top:6px;right:10px;cursor:pointer;font-weight:bold">√ó</span>`;
    t.style.cssText = `
      padding:12px 16px;border-radius:8px;font-size:14px;color:#fff;position:relative;
      animation:toastIn .3s ease;box-shadow:0 4px 12px rgba(0,0,0,.25);border-left:4px solid;
    `;
    const colors = {info:"#3498db",success:"#2ecc71",error:"#e74c3c",warning:"#f1c40f"};
    t.style.background = colors[type]+"cc"; t.style.borderColor = colors[type];
    t.querySelector("span").onclick = () => close();
    toastRoot.append(t);
    const close = () => {t.style.animation="toastOut .3s forwards";setTimeout(()=>t.remove(),300);};
    if (ms>0) setTimeout(close, ms);
    return t;
  }
  const styleEl = document.createElement("style"); styleEl.textContent = `
  @keyframes toastIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
  @keyframes toastOut{from{transform:translateX(0);opacity:1}to{transform:translateX(100%);opacity:0}}
  .toast.info{background:#3498dbcc;border-color:#3498db}.toast.success{background:#2ecc71cc;border-color:#2ecc71}
  .toast.error{background:#e74c3ccc;border-color:#e74c3c}.toast.warning{background:#f1c40fcc;border-color:#f1c40f}`;
  document.head.append(styleEl);
  
  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  navigation  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function initNav() {
    $$("nav button").forEach(b=>{
      b.onclick=()=>{ $("nav button.active").classList.remove("active");
        b.classList.add("active");
        $("section.active").classList.remove("active");
        $("#"+b.dataset.target).classList.add("active");
      };
    });
  }
  
  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  motivational quotes  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function initQuotes() {
    const quotes = [
      "Start where you are.","Progress over perfection.","One step at a time.","Dream, believe, do.",
      "Focus and win.","Every day is a second chance.","Small progress is progress.","Stay positive.",
      "Believe you can.","Do it now.","Keep pushing.","Consistency is key.","Success is a journey.",
      "You got this.","Make today count."
    ];
    function render() {
      const box=$("#quotes"); box.innerHTML="";
      quotes.sort(()=>.5-Math.random()).slice(0,3).forEach(q=>{
        const d=document.createElement("div");d.className="card";d.textContent=`"${q}"`;box.append(d);
      });
    }
    render(); $("#refreshQuotes").onclick=render;
  }
  
  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  Pomodoro timer  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function initPomodoro(){
    let secs=25*60,run=false,timer;
    const disp=$("#timerDisplay");
    const fmt=()=>disp.textContent=`${String(Math.floor(secs/60)).padStart(2,"0")}:${String(secs%60).padStart(2,"0")}`;
    fmt();
    $("#startTimer").onclick=()=>{
      if(run) return; run=true;
      timer=setInterval(()=>{ if(secs>0){secs--;fmt();}else{clearInterval(timer);run=false;
        confetti({particleCount:120,spread:70,origin:{y:.6}}); toast("Pomodoro done!","success");}
      },1000);
    };
    $("#pauseTimer").onclick=()=>{clearInterval(timer);run=false;};
    $("#resetTimer").onclick=()=>{clearInterval(timer);run=false;secs=25*60;fmt();};
  }
  
  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  tasks / Kanban  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function initTasks(){
    const load=()=>JSON.parse(localStorage.getItem("sb-tasks")||'{"todo":[],"inprogress":[],"completed":[]}');
    const save=o=>localStorage.setItem("sb-tasks",JSON.stringify(o));
    const render=()=>{
      const data=load();
      ["todo","inprogress","completed"].forEach(stat=>{
        const col=$(`.column[data-status='${stat}']`); const title=col.querySelector("h3").textContent;
        col.innerHTML=`<h3>${title}</h3>`;
        data[stat].forEach((t,i)=>{
          col.insertAdjacentHTML("beforeend",`
            <div class="task"><span>${t}</span>
              <div class="task-buttons">
                ${stat==="todo"?`<button data-a="start" data-i="${i}" class="btn btn-small btn-primary">Start</button>`:""}
                ${stat==="inprogress"?`<button data-a="complete" data-i="${i}" class="btn btn-small btn-primary">Complete</button>`:""}
                <button data-a="del" data-s="${stat}" data-i="${i}" class="btn btn-small btn-secondary">√ó</button>
              </div>
            </div>`);
        });
      });
    };
    $("#newTaskForm").onsubmit=e=>{
      e.preventDefault();const v=$("#newTaskInput").value.trim(); if(!v) return;
      const d=load(); d.todo.push(v); save(d); render(); e.target.reset();
    };
    $("#tasksBoard").onclick=e=>{
      const btn=e.target.closest("button[data-a]"); if(!btn) return;
      const d=load(); const i=+btn.dataset.i;
      if(btn.dataset.a==="del") d[btn.dataset.s].splice(i,1);
      if(btn.dataset.a==="start"){ d.todo.splice(i,1).forEach(t=>d.inprogress.push(t));}
      if(btn.dataset.a==="complete"){ d.inprogress.splice(i,1).forEach(t=>d.completed.push(t));
        confetti({particleCount:100,spread:70,origin:{y:.6}});}
      save(d); render();
    };
    render();
  }
  
  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  cafe reviews  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function initReviews(){
    const store={get:(def=[])=>{try{return JSON.parse(localStorage.getItem("sb-reviews")||"[]");}
                                 catch{ return def;}},
                 set:arr=>localStorage.setItem("sb-reviews",JSON.stringify(arr))};
  
    /* ------------   render all reviews  -------------- */
    function render(){
      const revs=store.get();
      const wrap=$("#cafeReviews");
      if(!wrap) return;
      wrap.innerHTML="";
      if(!revs.length){wrap.innerHTML=`<div class="card" style="text-align:center;padding:2rem;">
         <div style="font-size:4rem">üìù</div><p>No reviews yet</p></div>`; return;}
      revs.forEach((r,i)=>{
        const c=document.createElement("div"); c.className="card cafe-review-card";
        c.innerHTML=`
          <div class="review-header"><h3>${r.name}</h3>
            <div>${"‚òÖ".repeat(r.rating)}${"‚òÜ".repeat(5-r.rating)}</div></div>
          <p class="review-body">${r.text}</p>
          <div class="review-footer">${r.date||""} ‚Ä¢ ${r.category}</div>
          <button class="delete-review" data-id="${r.id||''}" data-idx="${i}"
            style="position:absolute;top:6px;right:10px;background:none;border:none;
            color:var(--ac-warn);font-size:20px;cursor:pointer;">√ó</button>`;
        wrap.append(c);
      });
    }
  
    /* ------------   delete handler (works for legacy & new)  ----------- */
    $("#cafeReviews").addEventListener("click", e=>{
      const btn=e.target.closest(".delete-review"); if(!btn) return;
      const list=store.get();
      if(btn.dataset.id){
        store.set(list.filter(r=>r.id!==btn.dataset.id));
      }else{ list.splice(+btn.dataset.idx,1); store.set(list);}
      render(); toast("Review deleted","success");
    });
  
    /* ------------   save-review form  ---------------- */
    $("#reviewForm").onsubmit=e=>{
      e.preventDefault();
      const name=$("#reviewName").value.trim(),
            rating=+$("#reviewRating").value,
            cat=$("#reviewCategory").value,
            text=$("#reviewText").value.trim();
      if(!name||!rating||!cat||!text){toast("Please fill all fields","error");return;}
      const revs=store.get(); revs.push({
        id:crypto.randomUUID(), name,rating,category:cat,text,
        date:new Date().toISOString().split("T")[0]
      });
      store.set(revs); e.target.reset(); render(); toast("Review added","success");
    };
  
    render();
  }
  
  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  study planner  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function initPlanner(){
    const load=()=>JSON.parse(localStorage.getItem("sb-plans")||"[]");
    const save=p=>localStorage.setItem("sb-plans",JSON.stringify(p));
  
    function render(){
      const plans=load();
      const list=$("#planList"); list.innerHTML="";
      if(!plans.length){list.innerHTML='<div class="card" style="text-align:center">No study plans</div>';return;}
      plans.sort((a,b)=>new Date(a.date)-new Date(b.date));
      const emojis={Homework:"üìù",Reading:"üìö",Project:"üõ†Ô∏è",Review:"üîç",Exam:"üìä",Essay:"‚úçÔ∏è",
                    Presentation:"üéØ",Research:"üî¨",Lab:"üß™",Other:"üìå"};
      plans.forEach((p,i)=>{
        const d=document.createElement("div");d.className="card";
        d.innerHTML=`
          <h4 style="display:flex;gap:8px;align-items:center"><span style="font-size:1.3em">${emojis[p.category]||"üìå"}</span>${p.title}</h4>
          <small>${new Date(p.date).toLocaleDateString()} ‚Ä¢ ${p.category}</small>
          <p>${p.desc||""}</p>
          <button class="delete-plan" data-i="${i}" style="position:absolute;top:8px;right:10px;background:none;border:none;color:var(--ac-warn);font-size:20px">√ó</button>`;
        list.append(d);
      });
    }
    $("#plannerForm").onsubmit=e=>{
      e.preventDefault();
      const t=$("#planTitle").value.trim(),c=$("#planCat").value,d=$("#planDate").value,desc=$("#planDesc").value.trim();
      if(!t||!c||!d){toast("Please fill all required fields","error");return;}
      const plans=load(); plans.push({title:t,category:c,date:d,desc}); save(plans); render(); e.target.reset();
    };
    $("#planList").onclick=e=>{
      const b=e.target.closest(".delete-plan"); if(!b) return;
      const plans=load(); plans.splice(+b.dataset.i,1); save(plans); render(); toast("Plan deleted","info");
    };
  
    /* -------- generate study plan advice -------- */
    $("#planStudy").onclick=()=>{
      const tasks=load(); const out=$("#plannerAdvice");
      if(!tasks.length){out.textContent="Add some tasks first.";return;}
      tasks.sort((a,b)=>new Date(a.date)-new Date(b.date));
      const today=new Date();
      tasks.forEach(t=>t.days=Math.ceil((new Date(t.date)-today)/(864e5)));
      let md=`# Personalized Study Plan\n\nToday is ${today.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}\n\n`;
      const group={};
      tasks.forEach(t=>{
        const k=t.days<=0?"Today":t.days===1?"Tomorrow":`In ${t.days} days`;
        (group[k]=group[k]||[]).push(t);
      });
      for(const k of Object.keys(group)){
        md+=`## ${k}\n\n`;group[k].forEach(t=>{
          md+=`### ${t.title} (${t.category})\n- Due: ${t.date}\n`;
          md+=`- ‚è∞ Focus for 1-2h blocks with 5-10 min breaks\n\n`;
        });
      }
      /* convert to basic HTML */
      const html=md.split("\n").map(l=>{
        if(l.startsWith("# ")){return`<h1>${l.slice(2)}</h1>`;}
        if(l.startsWith("## ")){return`<h2>${l.slice(3)}</h2>`;}
        if(l.startsWith("### ")){return`<h3>${l.slice(4)}</h3>`;}
        if(l.startsWith("- ")){return`<li>${l.slice(2)}</li>`;}
        return `<p>${l}</p>`;
      }).join("");
      out.innerHTML=`<div style="max-height:400px;overflow:auto;padding:15px">${html}</div>
        <button id="downloadPlan" class="btn btn-primary" style="margin:15px auto;display:block">üì• Download Plan</button>`;
      $("#downloadPlan").onclick=()=>{
        const txt=out.innerText;
        const blob=new Blob([txt],{type:"text/plain"}); const url=URL.createObjectURL(blob);
        const a=document.createElement("a");a.href=url;a.download="StudyBuddy_Plan.txt";
        document.body.append(a);a.click();a.remove();URL.revokeObjectURL(url); toast("Plan downloaded","success");
      };
    };
  
    render();
  }
  
  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  study sessions  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function initSessions(){
    const load=()=>JSON.parse(localStorage.getItem("sb-sessions")||"[]");
    const save=s=>localStorage.setItem("sb-sessions",JSON.stringify(s));
    function render(){
      const ul=$("#sessionList"); const s=load(); ul.innerHTML="";
      if(!s.length){ul.innerHTML='<li class="card">No sessions yet.</li>';return;}
      s.sort((a,b)=>new Date(b.date)-new Date(a.date));
      s.forEach((o,i)=>ul.insertAdjacentHTML("beforeend",`
        <li class="card" style="margin:.4rem 0">${o.topic} ‚Äî ${o.date} ‚Ä¢ ${o.duration} min
          <button data-i="${i}" class="btn btn-small btn-secondary" style="float:right">Del</button></li>`));
    }
    $("#sessionForm").onsubmit=e=>{
      e.preventDefault();
      const t=$("#sessionTopic").value.trim(),d=$("#sessionDate").value,m=+$("#sessionDuration").value;
      if(!t||!d||!m){toast("Fill all fields","error");return;}
      const s=load(); s.push({topic:t,date:d,duration:m}); save(s); render(); e.target.reset(); toast("Session added","success");
    };
    $("#sessionList").onclick=e=>{
      const i=e.target.dataset.i; if(i==null) return;
      const s=load(); s.splice(i,1); save(s); render(); toast("Session deleted","info");
    };
    render();
  }
  
  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  chat widget (local AI)  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function initChat(){
    $("#chatToggle").onclick=()=>$("#chatWidget").classList.toggle("open");
    $("#chatClose").onclick=()=>$("#chatWidget").classList.remove("open");
    function addRow(cls,txt){$("#chatBody").insertAdjacentHTML("beforeend",`<div class="row ${cls}"><p>${txt}</p></div>`);$("#chatBody").scrollTop=$("#chatBody").scrollHeight;}
    $("#chatInput").onsubmit=async e=>{
      e.preventDefault();const inp=e.target.querySelector("input"); const msg=inp.value.trim(); if(!msg)return;
      addRow("me",msg); inp.value=""; addRow("bot","‚Ä¶");
      const fallback=[
        "I'm here to help ‚Äì what are you studying?","Need help organising your schedule?",
        "Pomodoro sessions boost focus. Give them a try!","Remember to stay hydrated ü§ó",
        "Teach the concept to someone else ‚Äì it really sticks.","Flashcards work great for definitions!"
      ];
      await new Promise(r=>setTimeout(r,800));
      const rows=$$("#chatBody .bot p"); rows[rows.length-1].textContent=fallback[Math.floor(Math.random()*fallback.length)];
    };
  }
  
  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  games  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function initGames(){
    const games=[["Wordle Clone","https://wordlegame.org/"],["Hangman","https://hangmanwordgame.com/"],
                 ["Flappy Bird","https://flappybird.io/"],["Minesweeper","https://kamoroso94.github.io/minesweeper/"],
                 ["Sudoku","https://sudoku.com/"],["Connect Four","https://torikul007.github.io/Connect_Four/"]];
    const sel=$("#gameSelect"); games.forEach(g=>sel.insertAdjacentHTML("beforeend",`<option value="${g[1]}">${g[0]}</option>`));
    sel.onchange=()=>$("#gameFrame").src=sel.value; sel.selectedIndex=0; sel.dispatchEvent(new Event("change"));
  }
  
  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  Leaflet map  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function initCafeMap(){
    const mapEl=$("#map"); if(!mapEl) return;
    const loadLeaflet=()=>new Promise((ok,er)=>{
      if(window.L) return ok();
      const js=document.createElement("script");js.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js";
      js.onload=ok;js.onerror=er;document.head.append(js);
      const css=document.createElement("link");css.rel="stylesheet";
      css.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css";document.head.append(css);
    });
    loadLeaflet().then(()=>{
      navigator.geolocation.getCurrentPosition(got,()=>got({coords:{latitude:25.2769,longitude:55.2962}}));
      function got(pos){
        const {latitude:lat,longitude:lng}=pos.coords;
        const map=L.map(mapEl,{center:[lat,lng],zoom:14}); window.leafletMap=map;
        L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",{maxZoom:19}).addTo(map);
        L.marker([lat,lng]).addTo(map).bindPopup("You are here").openPopup();
        const searchCircle=L.circle([lat,lng],{radius:5000,color:"#8c67ff",fillOpacity:.05}).addTo(map);
        /* radius slider */
        const ctl=L.control({position:"topleft"}); ctl.onAdd=()=>{
          const c=L.DomUtil.create("div","leaflet-bar");c.style.background="rgba(30,30,30,.7)";c.style.padding="8px";
          c.innerHTML=`<input type="range" min="1000" max="30000" step="1000" value="5000" id="radiusSlider" style="width:160px">
            <div style="font-size:12px;color:#fff;text-align:center"><span id="radiusVal">5</span> km</div>`;
          L.DomEvent.disableClickPropagation(c);return c;};
        ctl.addTo(map);
        $("#radiusSlider").oninput=e=>$("#radiusVal").textContent=(e.target.value/1000).toFixed(1);
        $("#radiusSlider").onchange=e=>{searchCircle.setRadius(+e.target.value);fetchCafes(+e.target.value);}
        fetchCafes(5000);
        /* ------- fetch caf√©s ---------- */
        let markers=[];
        function clear(){markers.forEach(m=>m.remove());markers=[];}
        function fetchCafes(rad){
          clear(); toast("Searching caf√©s‚Ä¶","info",1500);
          const q=`[out:json][timeout:15];
            (node["amenity"~"cafe|library|college|university"](around:${rad},${lat},${lng});
             node["shop"="coffee"](around:${rad},${lat},${lng});
             node["cuisine"="coffee_shop"](around:${rad},${lat},${lng});
             node["amenity"="restaurant"]["cuisine"~"coffee_shop|cafe"](around:${rad},${lat},${lng}););
            out body;`;
          fetch("https://overpass-api.de/api/interpreter",{method:"POST",body:"data="+encodeURIComponent(q)})
            .then(r=>r.json()).then(d=>{
              if(!d.elements.length) return toast("No caf√©s found","warning");
              d.elements.filter(e=>e.lat&&e.lon).forEach(n=>{
                const name=n.tags.name||"Unnamed"; const m=L.marker([n.lat,n.lon]).addTo(map)
                  .bindPopup(`<strong>${name}</strong><br>${n.tags.amenity||n.tags.shop||''}
                    <br><button class="btn btn-small btn-primary" onclick="selectCafeForReview('${name.replace(/'/g,"\\'")}')">Add review</button>`);
                markers.push(m);
              });
              toast(`Found ${markers.length} spots`,"success");
            }).catch(()=>toast("Overpass error","error"));
        }
      }
    }).catch(()=>toast("Failed to load map","error"));
  }
  /* helper accessible from popup */
  window.selectCafeForReview=name=>{$("#reviewName").value=name; $("#reviewForm").scrollIntoView({behavior:"smooth"});
    toast(`Selected ${name} for review`,"info",2000);};
  
  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  keyboard shortcuts  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  document.addEventListener("keydown",e=>{
    if(e.altKey&&e.key==="n") $("#newTaskInput")?.focus();
    if(e.altKey&&e.key>="1"&&e.key<="5") $$("nav button")[+e.key-1]?.click();
  });
  
  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  one-shot initialisation  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  document.addEventListener("DOMContentLoaded",()=>{
    if(window.VANTA?.DOTS) VANTA.DOTS({el:"#background",color:0x8c67ff,color2:0x4f46e5,backgroundColor:0x121212,
                                        mouseControls:true,touchControls:true,showLines:false,size:3,spacing:25});
    initNav();initQuotes();initPomodoro();initTasks();initReviews();initPlanner();
    initSessions();initChat();initGames();initCafeMap();
    toast("StudyBuddy loaded","success",1800);
  });
  
  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  service-worker (optional)  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  if("serviceWorker" in navigator){window.addEventListener("load",()=>navigator.serviceWorker.register("/service-worker.js").catch(()=>{}));}
  })();

  </script>
  
</body>
</html>
